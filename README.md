# üìò **–ü–æ–ª–Ω–æ–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º –≤ PostgreSQL**
## **–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –ò–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ SkillFlow**

---

## **–ì–ª–∞–≤–∞ 1: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞**

### **1.1 –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è?**

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ **–∞—Ç–æ–º–∞—Ä–Ω–æ** (–∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ). –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ PostgreSQL —Å–ª–µ–¥—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **ACID**:

- **Atomicity** (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å) ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–ª–∏ –Ω–∏ –æ–¥–Ω–∞
- **Consistency** (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å) ‚Äî –ë–î –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥—Ä—É–≥–æ–µ
- **Isolation** (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å) ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
- **Durability** (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å) ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è SkillFlow?** –ö–æ–≥–¥–∞ —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–∫—É–ø–∞–µ—Ç –∫—É—Ä—Å, –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:
1. –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –±–∞–ª–∞–Ω—Å–∞
2. –°–æ–∑–¥–∞–Ω–∏–µ —É—á–µ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
3. –ó–∞–ø–∏—Å—å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ

–ï—Å–ª–∏ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö —à–∞–≥–æ–≤ fail, –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –í–°–Å ‚Äî —Å—Ç—É–¥–µ–Ω—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ—Ç–µ—Ä—è—Ç—å –¥–µ–Ω—å–≥–∏ –±–µ–∑ –∫—É—Ä—Å–∞.

### **1.2 –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ PostgreSQL**

PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3 —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ (–æ—Ç —Å–ª–∞–±–æ–≥–æ –∫ —Å–∏–ª—å–Ω–æ–º—É):

| –£—Ä–æ–≤–µ–Ω—å | –ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ | –ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ | –§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
|---------|----------------|---------------------|-----------------|------------|
| **READ COMMITTED** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ |
| **REPEATABLE READ** | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è | –ë–æ–ª—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ |
| **SERIALIZABLE** | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ, –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ |

**–í–Ω–∏–º–∞–Ω–∏–µ**: –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä—É–≥–∏—Ö –°–£–ë–î, PostgreSQL **–ù–ï –¥–æ–ø—É—Å–∫–∞–µ—Ç –≥—Ä—è–∑–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è** –¥–∞–∂–µ –Ω–∞ —Å–∞–º–æ–º –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ –∏–∑–æ–ª—è—Ü–∏–∏!

### **1.3 –ú–æ–¥–µ–ª—å MVCC (Multiversion Concurrency Control)**

PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MVCC –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–ª—è—Ü–∏–∏. **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:

1. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç `xmin` (ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ–∑–¥–∞–≤—à–µ–π —Å—Ç—Ä–æ–∫—É) –∏ `xmax` (ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —É–¥–∞–ª–∏–≤—à–µ–π/–æ–±–Ω–æ–≤–∏–≤—à–µ–π —Å—Ç—Ä–æ–∫—É)
2. –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–∏–¥–∏—Ç "—Å–Ω–∏–º–æ–∫" –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–≤–æ–µ–≥–æ –Ω–∞—á–∞–ª–∞
3. –ü—Ä–∏ UPDATE —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–æ–∫–∏, —Å—Ç–∞—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ –æ—á–∏—Å—Ç–∫–∏ autovacuum

```
–¢–∞–±–ª–∏—Ü–∞ Students (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ MVCC):
ID | –ò–º—è     | –ë–∞–ª–∞–Ω—Å | xmin | xmax 
---|---------|--------|------|------
101| –ê–ª–µ–∫—Å–µ–π | 10000  | 100  | NULL  <- –í–∏–¥–∏–º–∞ –¥–ª—è –≤—Å–µ—Ö
101| –ê–ª–µ–∫—Å–µ–π | 11000  | 200  | NULL  <- –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ UPDATE
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ MVCC**: –ß–∏—Ç–∞—Ç–µ–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–∏—Å–∞—Ç–µ–ª–µ–π, –ø–∏—Å–∞—Ç–µ–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —á–∏—Ç–∞—Ç–µ–ª–µ–π.

---

## **–ì–ª–∞–≤–∞ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

### **2.1 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SkillFlow**

#### **–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ PostgreSQL**

1. **–°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL** —Å [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞](https://www.postgresql.org/download/)
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**:
   - Windows: –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –°–ª—É–∂–±—ã ‚Üí "PostgreSQL" ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å
   - Linux: `sudo systemctl start postgresql`
   - macOS: `brew services start postgresql`

#### **–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DataGrip**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ DataGrip** ‚Üí –Ω–∞–∂–º–∏—Ç–µ **Alt+Shift+S** (Windows) –∏–ª–∏ **Cmd+Shift+S** (macOS)
2. **–î–æ–±–∞–≤—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**:
   ```
   –¢–∏–ø: PostgreSQL
   –•–æ—Å—Ç: localhost
   –ü–æ—Ä—Ç: 5432
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: postgres
   –ü–∞—Ä–æ–ª—å: [–≤–∞—à –ø–∞—Ä–æ–ª—å]
   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: postgres (–≤—Ä–µ–º–µ–Ω–Ω–æ)
   ```
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** ‚Üí –Ω–∞–∂–º–∏—Ç–µ **Test Connection**

#### **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö skillflow**

```sql
-- –í –∫–æ–Ω—Å–æ–ª–∏ DataGrip –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
CREATE DATABASE skillflow
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_US.UTF-8'
    LC_CTYPE = 'en_US.UTF-8'
    CONNECTION LIMIT = -1
    IS_TEMPLATE = False;

COMMENT ON DATABASE skillflow IS '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ SkillFlow';
```

#### **–®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ skillflow**

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ DataGrip —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –Ω–æ —É–∫–∞–∂–∏—Ç–µ **Database: skillflow**.

### **2.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü**

#### **–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?**

–ú—ã —Å–æ–∑–¥–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É —Å–æ–≥–ª–∞—Å–Ω–æ 3–ù–§ (—Ç—Ä–µ—Ç—å–µ–π –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ):
- –ö–∞–∂–¥–∞—è —Å—É—â–Ω–æ—Å—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –í—Å–µ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∑–∞–≤–∏—Å—è—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

```sql
-- ============================================
-- 1. –¢–∞–±–ª–∏—Ü–∞ –≠–∫—Å–ø–µ—Ä—Ç–æ–≤ (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞)
-- ============================================
CREATE TABLE Experts (
    ID_–≠–∫—Å–ø–µ—Ä—Ç–∞ INTEGER PRIMARY KEY,
    –ò–º—è_–≠–∫—Å–ø–µ—Ä—Ç–∞ VARCHAR(50) NOT NULL,
    –§–∞–º–∏–ª–∏—è_–≠–∫—Å–ø–µ—Ä—Ç–∞ VARCHAR(50) NOT NULL,
    Email_–≠–∫—Å–ø–µ—Ä—Ç–∞ VARCHAR(100) UNIQUE NOT NULL,
    –ë–∏–æ–≥—Ä–∞—Ñ–∏—è_–≠–∫—Å–ø–µ—Ä—Ç–∞ TEXT,
    –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è_–≠–∫—Å–ø–µ—Ä—Ç–∞ VARCHAR(100),
    
    -- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
    CONSTRAINT check_email_format 
        CHECK (Email_–≠–∫—Å–ø–µ—Ä—Ç–∞ ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$')
);

COMMENT ON TABLE Experts IS '–¢–∞–±–ª–∏—Ü–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤-–∞–≤—Ç–æ—Ä–æ–≤ –∫—É—Ä—Å–æ–≤';
COMMENT ON COLUMN Experts.ID_–≠–∫—Å–ø–µ—Ä—Ç–∞ IS '–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–∫—Å–ø–µ—Ä—Ç–∞ (PK)';
COMMENT ON COLUMN Experts.Email_–≠–∫—Å–ø–µ—Ä—Ç–∞ IS '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è)';

-- ============================================
-- 2. –¢–∞–±–ª–∏—Ü–∞ –°—Ç—É–¥–µ–Ω—Ç–æ–≤
-- ============================================
CREATE TABLE Students (
    ID_–°—Ç—É–¥–µ–Ω—Ç–∞ INTEGER PRIMARY KEY,
    –ò–º—è_–°—Ç—É–¥–µ–Ω—Ç–∞ VARCHAR(50) NOT NULL,
    –§–∞–º–∏–ª–∏—è_–°—Ç—É–¥–µ–Ω—Ç–∞ VARCHAR(50) NOT NULL,
    Email_–°—Ç—É–¥–µ–Ω—Ç–∞ VARCHAR(100) UNIQUE NOT NULL,
    –î–∞—Ç–∞_–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏_–°—Ç—É–¥–µ–Ω—Ç–∞ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    –ë–∞–ª–∞–Ω—Å DECIMAL(10,2) DEFAULT 0.00 CHECK (–ë–∞–ª–∞–Ω—Å >= 0),
    
    CONSTRAINT students_email_check 
        CHECK (Email_–°—Ç—É–¥–µ–Ω—Ç–∞ ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$')
);

COMMENT ON TABLE Students IS '–¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã SkillFlow';
COMMENT ON COLUMN Students.–ë–∞–ª–∞–Ω—Å IS '–ë–∞–ª–∞–Ω—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫—É—Ä—Å–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)';

-- ============================================
-- 3. –¢–∞–±–ª–∏—Ü–∞ –ö—É—Ä—Å–æ–≤
-- ============================================
CREATE TABLE Courses (
    ID_–ö—É—Ä—Å–∞ INTEGER PRIMARY KEY,
    –ù–∞–∑–≤–∞–Ω–∏–µ_–ö—É—Ä—Å–∞ VARCHAR(255) NOT NULL,
    –û–ø–∏—Å–∞–Ω–∏–µ_–ö—É—Ä—Å–∞ TEXT,
    –î–∞—Ç–∞_–°–æ–∑–¥–∞–Ω–∏—è_–ö—É—Ä—Å–∞ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ID_–≠–∫—Å–ø–µ—Ä—Ç–∞ INTEGER NOT NULL REFERENCES Experts(ID_–≠–∫—Å–ø–µ—Ä—Ç–∞) 
        ON DELETE CASCADE ON UPDATE CASCADE,
    
    CONSTRAINT courses_title_length CHECK (length(–ù–∞–∑–≤–∞–Ω–∏–µ_–ö—É—Ä—Å–∞) >= 5)
);

CREATE INDEX idx_courses_expert ON Courses(ID_–≠–∫—Å–ø–µ—Ä—Ç–∞);
COMMENT ON TABLE Courses IS '–¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã';

-- ============================================
-- 4. –¢–∞–±–ª–∏—Ü–∞ –¶–µ–Ω –ö—É—Ä—Å–æ–≤ (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è)
-- ============================================
CREATE TABLE Course_Prices (
    ID_–ö—É—Ä—Å–∞ INTEGER NOT NULL,
    –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã TIMESTAMP NOT NULL,
    –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ DECIMAL(10,2) NOT NULL CHECK (–¶–µ–Ω–∞_–ö—É—Ä—Å–∞ > 0),
    –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã TIMESTAMP NULL,
    
    PRIMARY KEY (ID_–ö—É—Ä—Å–∞, –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã),
    FOREIGN KEY (ID_–ö—É—Ä—Å–∞) REFERENCES Courses(ID_–ö—É—Ä—Å–∞) 
        ON DELETE CASCADE ON UPDATE CASCADE,
    
    CONSTRAINT valid_price_period CHECK (
        –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL 
        OR –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã > –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã
    )
);

COMMENT ON TABLE Course_Prices IS '–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –∫—É—Ä—Å–æ–≤';
COMMENT ON COLUMN Course_Prices.–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS 'NULL –æ–∑–Ω–∞—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–µ–π—Å—Ç–≤—É—é—â—É—é —Ü–µ–Ω—É';

-- ============================================
-- 5. –¢–∞–±–ª–∏—Ü–∞ –£—á–µ–±–Ω—ã—Ö –ü–ª–∞–Ω–æ–≤ (–æ—Å–Ω–æ–≤–Ω–∞—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
-- ============================================
CREATE TABLE StudyPlans (
    ID_–ü–ª–∞–Ω–∞ SERIAL PRIMARY KEY,
    –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞ TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è DATE NOT NULL,
    –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ VARCHAR(50) NOT NULL DEFAULT '–∞–∫—Ç–∏–≤–µ–Ω' 
        CHECK (–°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ IN ('–∞–∫—Ç–∏–≤–µ–Ω', '–∑–∞–≤–µ—Ä—à–µ–Ω', '–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', '–æ—Ç–º–µ–Ω–µ–Ω')),
    ID_–°—Ç—É–¥–µ–Ω—Ç–∞ INTEGER NOT NULL REFERENCES Students(ID_–°—Ç—É–¥–µ–Ω—Ç–∞),
    ID_–ö—É—Ä—Å–∞ INTEGER NOT NULL REFERENCES Courses(ID_–ö—É—Ä—Å–∞),
    
    CONSTRAINT valid_end_date CHECK (–ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è > –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞::DATE)
);

-- –í–ê–ñ–ù–û: –ß–∞—Å—Ç–∏—á–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è –û–¢–î–ï–õ–¨–ù–û
-- PostgreSQL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WHERE –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ UNIQUE –ø—Ä–∏ CREATE TABLE
CREATE UNIQUE INDEX idx_studyplans_active_unique 
ON StudyPlans(ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞) 
WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';

COMMENT ON TABLE StudyPlans IS '–£—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤';
COMMENT ON INDEX idx_studyplans_active_unique IS '–°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –∫—É—Ä—Å';

-- ============================================
-- 6. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
-- ============================================
CREATE TABLE Progress (
    ID_–ü—Ä–æ–≥—Ä–µ—Å—Å–∞ SERIAL PRIMARY KEY,
    –î–∞—Ç–∞_–ó–∞–≤–µ—Ä—à–µ–Ω–∏—è_–£—Ä–æ–∫–∞ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ID_–°—Ç—É–¥–µ–Ω—Ç–∞ INTEGER NOT NULL REFERENCES Students(ID_–°—Ç—É–¥–µ–Ω—Ç–∞),
    ID_–£—Ä–æ–∫–∞ INTEGER NOT NULL, -- –£–ø—Ä–æ—â–µ–Ω–Ω–æ, –±–µ–∑ —Å—Å—ã–ª–∫–∏ –Ω–∞ Lessons
    UNIQUE(ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–£—Ä–æ–∫–∞)
);

CREATE TABLE Certificates (
    ID_–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ SERIAL PRIMARY KEY,
    –î–∞—Ç–∞_–í—ã–¥–∞—á–∏_–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    –°—Å—ã–ª–∫–∞_–ù–∞_–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç VARCHAR(255),
    ID_–°—Ç—É–¥–µ–Ω—Ç–∞ INTEGER NOT NULL REFERENCES Students(ID_–°—Ç—É–¥–µ–Ω—Ç–∞),
    ID_–ö—É—Ä—Å–∞ INTEGER NOT NULL REFERENCES Courses(ID_–ö—É—Ä—Å–∞),
    UNIQUE(ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
);
```

#### **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:**

1. **–ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è**: –°–Ω–∞—á–∞–ª–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã (`Experts`, `Students`), –∑–∞—Ç–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ (`Courses`), –∑–∞—Ç–µ–º —Ç–∞–±–ª–∏—Ü—ã —Å –¥–≤–æ–π–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
2. **–ß–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è StudyPlans**: –ú—ã —Å–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å —Å —É—Å–ª–æ–≤–∏–µ–º `WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω'` –æ—Ç–¥–µ–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ PostgreSQL –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç `WHERE` –≤ `UNIQUE` –ø—Ä–∏ `CREATE TABLE`
3. **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å ON DELETE CASCADE**: –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —ç–∫—Å–ø–µ—Ä—Ç–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –µ–≥–æ –∫—É—Ä—Å—ã

### **2.3 –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**

```sql
-- ============================================
-- 1. –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
-- ============================================
-- –ò—Å–ø–æ–ª—å–∑—É–µ–º TRUNCATE —Å CASCADE –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
TRUNCATE TABLE Certificates, Progress, StudyPlans, 
             Course_Prices, Courses, Students, Experts 
CASCADE;

-- ============================================
-- 2. –í—Å—Ç–∞–≤–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–¥–∞–Ω–Ω—ã–µ –∏–∑ Excel)
-- ============================================
INSERT INTO Experts (ID_–≠–∫—Å–ø–µ—Ä—Ç–∞, –ò–º—è_–≠–∫—Å–ø–µ—Ä—Ç–∞, –§–∞–º–∏–ª–∏—è_–≠–∫—Å–ø–µ—Ä—Ç–∞, Email_–≠–∫—Å–ø–µ—Ä—Ç–∞, –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è_–≠–∫—Å–ø–µ—Ä—Ç–∞) VALUES
(501, '–ú–∞—Ä–∏—è', '–ü–µ—Ç—Ä–æ–≤–∞', 'maria.p@skillflow.com', 'Python'),
(502, '–ò–≤–∞–Ω', '–°–æ–∫–æ–ª–æ–≤', 'ivan.s@skillflow.com', 'JavaScript'),
(503, '–û–ª–µ–≥', '–í–æ–ª–∫–æ–≤', 'oleg.v@skillflow.com', 'SQL'),
(504, '–°—Ç–µ–ø–∞–Ω', '–ï–≥–æ—Ä–æ–≤', 'stepan.e@skillflow.com', 'DevOps'),
(505, '–ê–Ω–∞—Å—Ç–∞—Å–∏—è', '–†–æ–º–∞–Ω–æ–≤–∞', 'nastya.r@skillflow.com', 'React'),
(506, '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω', '–ú–µ–¥–≤–µ–¥–µ–≤', 'kostya.m@skillflow.com', 'Node.js'),
(507, '–ì—Ä–∏–≥–æ—Ä–∏–π', '–õ–µ–±–µ–¥–µ–≤', 'grisha.l@skillflow.com', 'Git'),
(508, '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–°–º–∏—Ä–Ω–æ–≤–∞', 'katya.s@skillflow.com', 'TypeScript'),
(509, '–ê—Ä—Ç—ë–º', '–ö—É–∑–Ω–µ—Ü–æ–≤', 'art.k@skillflow.com', '–ê–ª–≥–æ—Ä–∏—Ç–º—ã'),
(510, '–í–∏–∫—Ç–æ—Ä', '–°–µ–º—ë–Ω–æ–≤', 'viktor.s@skillflow.com', 'Kubernetes'),
(511, '–î–º–∏—Ç—Ä–∏–π', '–Ø–∫–æ–≤–ª–µ–≤', 'dima.y@skillflow.com', 'AWS');

-- ============================================
-- 3. –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ (—Å –±–∞–ª–∞–Ω—Å–∞–º–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
-- ============================================
INSERT INTO Students (ID_–°—Ç—É–¥–µ–Ω—Ç–∞, –ò–º—è_–°—Ç—É–¥–µ–Ω—Ç–∞, –§–∞–º–∏–ª–∏—è_–°—Ç—É–¥–µ–Ω—Ç–∞, Email_–°—Ç—É–¥–µ–Ω—Ç–∞, –î–∞—Ç–∞_–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏_–°—Ç—É–¥–µ–Ω—Ç–∞, –ë–∞–ª–∞–Ω—Å) VALUES
(101, '–ê–ª–µ–∫—Å–µ–π', '–ò–≤–∞–Ω–æ–≤', 'alex.ivanov@example.com', '2023-01-10 10:00:00', 10000.00),
(102, '–î–º–∏—Ç—Ä–∏–π', '–°–º–∏—Ä–Ω–æ–≤', 'dmitry.s@example.com', '2023-01-15 11:30:00', 5000.00),
(103, '–ï–ª–µ–Ω–∞', '–ö–æ–∑–ª–æ–≤–∞', 'elena.k@example.com', '2023-01-20 09:45:00', 7500.00),
(104, '–°–µ—Ä–≥–µ–π', '–ü–æ–ø–æ–≤', 'sergey.p@example.com', '2023-02-01 13:20:00', 3000.00),
(105, '–û–ª—å–≥–∞', '–í–∞—Å–∏–ª—å–µ–≤–∞', 'olga.v@example.com', '2023-02-05 10:10:00', 12000.00),
(106, '–ê–Ω–¥—Ä–µ–π', '–õ–µ–±–µ–¥–µ–≤', 'andrey.l@example.com', '2023-02-10 15:00:00', 6000.00),
(107, '–ù–∞—Ç–∞–ª—å—è', '–ú–æ—Ä–æ–∑–æ–≤–∞', 'natalia.m@example.com', '2023-02-12 11:15:00', 4500.00);

-- ============================================
-- 4. –í—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—Å–æ–≤ (–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞–º)
-- ============================================
INSERT INTO Courses (ID_–ö—É—Ä—Å–∞, –ù–∞–∑–≤–∞–Ω–∏–µ_–ö—É—Ä—Å–∞, –û–ø–∏—Å–∞–Ω–∏–µ_–ö—É—Ä—Å–∞, –î–∞—Ç–∞_–°–æ–∑–¥–∞–Ω–∏—è_–ö—É—Ä—Å–∞, ID_–≠–∫—Å–ø–µ—Ä—Ç–∞) VALUES
(401, 'Python –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö', '–ù–∞—É—á–∏—Ç–µ—Å—å –ø–∏—Å–∞—Ç—å –Ω–∞ Python —Å –Ω—É–ª—è', '2022-11-05 09:00:00', 501),
(402, 'JavaScript —Å –Ω—É–ª—è', '–ü–æ–ª–Ω—ã–π –∫—É—Ä—Å –ø–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º—É JS', '2022-12-01 10:00:00', 502),
(403, 'SQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤', '–ù–∞—É—á–∏—Ç–µ—Å—å –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î', '2023-01-10 08:00:00', 503),
(404, 'DevOps –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤', '–û—Å–≤–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã DevOps', '2023-02-01 09:00:00', 504),
(405, 'React –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö', '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ UI', '2023-03-01 10:00:00', 505),
(406, 'Node.js –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤', '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π API', '2023-03-15 09:00:00', 506),
(407, 'Git –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã', '–†–∞–±–æ—Ç–∞–π—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ', '2023-04-01 10:00:00', 507);

-- ============================================
-- 5. –í—Å—Ç–∞–≤–∫–∞ —Ü–µ–Ω –∫—É—Ä—Å–æ–≤ (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ)
-- ============================================
INSERT INTO Course_Prices (ID_–ö—É—Ä—Å–∞, –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã, –¶–µ–Ω–∞_–ö—É—Ä—Å–∞, –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã) VALUES
-- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã (–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL)
(401, '2024-01-01 00:00:00', 1999.99, NULL),
(402, '2024-01-01 00:00:00', 2499.99, NULL),
(403, '2024-01-01 00:00:00', 1799.99, NULL),
(404, '2024-01-01 00:00:00', 3199.99, NULL),
(405, '2024-01-01 00:00:00', 2299.99, NULL),
(406, '2024-01-01 00:00:00', 2599.99, NULL),
(407, '2024-01-01 00:00:00', 1499.99, NULL);

-- ============================================
-- 6. –í—Å—Ç–∞–≤–∫–∞ —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
-- ============================================
INSERT INTO StudyPlans (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞) VALUES
('2024-03-01 10:00:00', '2024-06-01', '–∞–∫—Ç–∏–≤–µ–Ω', 101, 401),
('2024-03-05 11:00:00', '2024-06-05', '–∞–∫—Ç–∏–≤–µ–Ω', 102, 402),
('2024-02-15 09:00:00', '2024-05-15', '–∑–∞–≤–µ—Ä—à–µ–Ω', 103, 401),
('2024-03-10 14:00:00', '2024-06-10', '–∞–∫—Ç–∏–≤–µ–Ω', 104, 403),
('2024-03-12 16:00:00', '2024-06-12', '–∞–∫—Ç–∏–≤–µ–Ω', 105, 404),
('2024-02-20 10:00:00', '2024-05-20', '–∑–∞–≤–µ—Ä—à–µ–Ω', 106, 402),
('2024-03-15 13:00:00', '2024-06-15', '–∞–∫—Ç–∏–≤–µ–Ω', 107, 405);

-- ============================================
-- 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
-- ============================================
SELECT '–≠–∫—Å–ø–µ—Ä—Ç—ã:' AS —Ç–∞–±–ª–∏—Ü–∞, COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ FROM Experts
UNION ALL
SELECT '–°—Ç—É–¥–µ–Ω—Ç—ã:', COUNT(*) FROM Students
UNION ALL
SELECT '–ö—É—Ä—Å—ã:', COUNT(*) FROM Courses
UNION ALL
SELECT '–¶–µ–Ω—ã –∫—É—Ä—Å–æ–≤:', COUNT(*) FROM Course_Prices
UNION ALL
SELECT '–£—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã:', COUNT(*) FROM StudyPlans;
```

**–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
```
—Ç–∞–±–ª–∏—Ü–∞     | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
------------+-----------
–≠–∫—Å–ø–µ—Ä—Ç—ã:   | 11
–°—Ç—É–¥–µ–Ω—Ç—ã:   | 7
–ö—É—Ä—Å—ã:      | 7
–¶–µ–Ω—ã –∫—É—Ä—Å–æ–≤:| 7
–£—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã:| 7
```

---

## **–ì–ª–∞–≤–∞ 3: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**

### **3.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DataGrip –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤**

#### **–®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –¥–≤–µ –∫–æ–Ω—Å–æ–ª–∏**

1. –í **Database Explorer** –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ `skillflow`
2. –í—ã–±–µ—Ä–∏—Ç–µ **New** ‚Üí **Query Console**
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π –∫–æ–Ω—Å–æ–ª–∏
4. **–†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ**: –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ‚Üí **Split Vertically**

#### **–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç**

1. File ‚Üí Settings ‚Üí Database ‚Üí General
2. **–°–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É** "Auto-commit"
3. –ù–∞–∂–º–∏—Ç–µ **Apply** ‚Üí **OK**

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?** –í —Ä–µ–∂–∏–º–µ —Å –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç–æ–º –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –∏ –º—ã –Ω–µ —Å–º–æ–∂–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤—Ä—É—á–Ω—É—é.

#### **–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–æ–±–∞–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–¥–µ—Ä–∂–∫–∏:
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –ª—é–±–æ–π –∫–æ–Ω—Å–æ–ª–∏
CREATE OR REPLACE FUNCTION delay(seconds INTEGER)
RETURNS VOID AS $$
BEGIN
    PERFORM pg_sleep(seconds);
END;
$$ LANGUAGE plpgsql;
```

### **3.2 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 1: –ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (Lost Update)**

#### **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
–î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–∏—Ç–∞—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è—é—Ç –µ–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –í—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–≤–æ–µ.

**–ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏**: –î–≤–∞ –∫–∞—Å—Å–∏—Ä–∞ –≤ –±–∞–Ω–∫–µ –≤–∏–¥—è—Ç –±–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞ = 10000‚ÇΩ. –ü–µ—Ä–≤—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç 1000‚ÇΩ, –≤—Ç–æ—Ä–æ–π –¥–æ–±–∞–≤–ª—è–µ—Ç 500‚ÇΩ. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 11500‚ÇΩ, –Ω–æ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å—Å—è –ª–∏–±–æ 11000‚ÇΩ, –ª–∏–±–æ 10500‚ÇΩ.

#### **–°—Ü–µ–Ω–∞—Ä–∏–π –≤ SkillFlow**
–î–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞—á–∏—Å–ª—è—é—Ç –±–æ–Ω—É—Å —Å—Ç—É–¥–µ–Ω—Ç—É.

**–°–µ—Å—Å–∏—è 1 (–ª–µ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å –≤ DataGrip):**
```sql
-- ============================================
-- –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø: –ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
-- –£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏: READ COMMITTED (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
-- ============================================

-- 0. –°–±—Ä–æ—Å–∏–º –±–∞–ª–∞–Ω—Å –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = 10000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
COMMIT;

-- 1. –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–Ω–µ—è–≤–Ω–æ READ COMMITTED)
BEGIN;

-- 2. –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
SELECT '=== –°–ï–°–°–ò–Ø 1 ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '1. –ß–∏—Ç–∞–µ–º –±–∞–ª–∞–Ω—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ 101 (–Ω–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏):' AS –¥–µ–π—Å—Ç–≤–∏–µ, 
       –ë–∞–ª–∞–Ω—Å AS —Ç–µ–∫—É—â–∏–π_–±–∞–ª–∞–Ω—Å,
       '–•–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å 1000' AS –ø–ª–∞–Ω
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 3. –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É (–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç.–¥.)
SELECT '2. –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É 3 —Å–µ–∫—É–Ω–¥—ã...' AS –¥–µ–π—Å—Ç–≤–∏–µ;
SELECT delay(3);  -- –ü–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã

-- 4. –ù–∞—á–∏—Å–ª—è–µ–º –±–æ–Ω—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –∑–Ω–∞—á–µ–Ω–∏—è
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 1000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT '3. –ü–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è +1000:' AS –¥–µ–π—Å—Ç–≤–∏–µ,
       –ë–∞–ª–∞–Ω—Å AS –Ω–æ–≤—ã–π_–±–∞–ª–∞–Ω—Å
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 6. –§–∏–∫—Å–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
COMMIT;
SELECT '4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ó–ê–í–ï–†–®–ï–ù–ê' AS –¥–µ–π—Å—Ç–≤–∏–µ;
```

**–°–µ—Å—Å–∏—è 2 (–ø—Ä–∞–≤–∞—è –∫–æ–Ω—Å–æ–ª—å, –∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏ 1):**
```sql
-- ============================================
-- –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–ê–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø
-- –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –°–µ—Å—Å–∏–∏ 1
-- ============================================

-- 1. –ù–∞—á–∏–Ω–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
BEGIN;

-- 2. –ß–∏—Ç–∞–µ–º —Ç–æ—Ç –∂–µ –±–∞–ª–∞–Ω—Å (—á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ —Å–µ—Å—Å–∏–∏ 1)
SELECT '=== –°–ï–°–°–ò–Ø 2 ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '1. –ß–∏—Ç–∞–µ–º –±–∞–ª–∞–Ω—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ 101 (–Ω–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏):' AS –¥–µ–π—Å—Ç–≤–∏–µ,
       –ë–∞–ª–∞–Ω—Å AS —Ç–µ–∫—É—â–∏–π_–±–∞–ª–∞–Ω—Å,
       '–•–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å 500' AS –ø–ª–∞–Ω
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 3. –ò–º–∏—Ç–∏—Ä—É–µ–º –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
SELECT '2. –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É 2 —Å–µ–∫—É–Ω–¥—ã...' AS –¥–µ–π—Å—Ç–≤–∏–µ;
SELECT delay(2);  -- –ü–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã

-- 4. –ù–∞—á–∏—Å–ª—è–µ–º –°–í–û–ô –±–æ–Ω—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ü–†–û–ß–ò–¢–ê–ù–ù–û–ì–û –∑–Ω–∞—á–µ–Ω–∏—è
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 500 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT '3. –ü–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è +500:' AS –¥–µ–π—Å—Ç–≤–∏–µ,
       –ë–∞–ª–∞–Ω—Å AS –Ω–æ–≤—ã–π_–±–∞–ª–∞–Ω—Å
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 6. –§–∏–∫—Å–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
COMMIT;
SELECT '4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ó–ê–í–ï–†–®–ï–ù–ê' AS –¥–µ–π—Å—Ç–≤–∏–µ;

-- 7. –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
SELECT '=== –§–ò–ù–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–° ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '–û–∂–∏–¥–∞–ª–æ—Å—å: 10000 + 1000 + 500 = 11500' AS –æ–∂–∏–¥–∞–Ω–∏–µ,
       '–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:' AS —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
       –ë–∞–ª–∞–Ω–° AS —Ñ–∏–Ω–∞–ª—å–Ω—ã–π_–±–∞–ª–∞–Ω—Å
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
```

#### **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç? –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞:**

```
–í—Ä–µ–º—è | –°–µ—Å—Å–∏—è 1                     | –°–µ—Å—Å–∏—è 2
------|-----------------------------|---------------------------
t=0   | BEGIN                       |
t=0   | SELECT (–≤–∏–¥–∏—Ç 10000)        |
t=1   | delay(3)                    | BEGIN
t=1   | ...                         | SELECT (—Ç–æ–∂–µ –≤–∏–¥–∏—Ç 10000!)
t=2   | ...                         | delay(2)
t=3   | UPDATE (—Å—Ç–∞–≤–∏—Ç 10000+1000)  | ...
t=3   | COMMIT (–±–∞–ª–∞–Ω—Å = 11000)     | ...
t=3   | ...                         | UPDATE (—á–∏—Ç–∞–µ—Ç –°–¢–ê–†–û–ï 10000, —Å—Ç–∞–≤–∏—Ç 10000+500)
t=3   | ...                         | COMMIT (–±–∞–ª–∞–Ω—Å = 10500 ‚Üê –û–®–ò–ë–ö–ê!)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–º–µ—Å—Ç–æ 11500 –ø–æ–ª—É—á–∞–µ–º 10500. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ +1000 –∏–∑ –°–µ—Å—Å–∏–∏ 1 **–ø–æ—Ç–µ—Ä—è–Ω–æ**.

#### **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**
1. –û–±–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–∏—Ç–∞—é—Ç **–æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∏—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (10000)
2. –û–±–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**
3. –í—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–π

### **3.3 –†–µ—à–µ–Ω–∏–µ 1: –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (SELECT FOR UPDATE)**

**–ò–¥–µ—è**: –Ø–≤–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –º–æ–≥–ª–∏ –µ–µ –∏–∑–º–µ–Ω–∏—Ç—å.

**–°–µ—Å—Å–∏—è 1 (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π):**
```sql
-- ============================================
-- –†–ï–®–ï–ù–ò–ï: –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
-- –ò—Å–ø–æ–ª—å–∑—É–µ–º SELECT ... FOR UPDATE
-- ============================================

-- 1. –°–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = 10000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
COMMIT;

-- 2. –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
BEGIN;

-- 3. –ë–õ–û–ö–ò–†–£–ï–ú –∑–∞–ø–∏—Å—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
SELECT '–ë–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞ 101...' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT –ë–∞–ª–∞–Ω—Å 
FROM Students 
WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101 
FOR UPDATE;  -- –ö–õ–Æ–ß–ï–í–ê–Ø –°–¢–†–û–ö–ê!

-- 4. –û–±—Ä–∞–±–æ—Ç–∫–∞
SELECT '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º 3 —Å–µ–∫—É–Ω–¥—ã...' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT delay(3);

-- 5. –û–±–Ω–æ–≤–ª—è–µ–º (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 1000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;

-- 6. –ó–∞–≤–µ—Ä—à–∞–µ–º
COMMIT;
SELECT '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 1000' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
```

**–°–µ—Å—Å–∏—è 2 (–±—É–¥–µ—Ç –∂–¥–∞—Ç—å):**
```sql
-- ============================================
-- –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–ê–Ø –ü–û–ü–´–¢–ö–ê –° –ë–õ–û–ö–ò–†–û–í–ö–û–ô
-- ============================================

BEGIN;

-- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç—É –∂–µ –∑–∞–ø–∏—Å—å
SELECT '–ü—ã—Ç–∞–µ–º—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–∞ 101...' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;

-- –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ë–£–î–ï–¢ –ñ–î–ê–¢–¨, –ø–æ–∫–∞ –°–µ—Å—Å–∏—è 1 –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
SELECT –ë–∞–ª–∞–Ω—Å 
FROM Students 
WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101 
FOR UPDATE;

-- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ COMMIT –≤ –°–µ—Å—Å–∏–∏ 1
SELECT '–ó–∞–ø–∏—Å—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT delay(2);
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 500 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
COMMIT;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT '–§–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ë–∞–ª–∞–Ω—Å 
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–∞–ª–∞–Ω—Å = 11500 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)

#### **–í–∞—Ä–∏–∞–Ω—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
- `FOR UPDATE` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `FOR SHARE` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è (–¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç —Ç–æ–∂–µ —á–∏—Ç–∞—Ç—å, –Ω–æ –Ω–µ –º–µ–Ω—è—Ç—å)
- `FOR NO KEY UPDATE` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –Ω–æ –Ω–µ –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É
- `NOWAIT` ‚Äî –Ω–µ –∂–¥–∞—Ç—å, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (—Å—Ä–∞–∑—É –æ—à–∏–±–∫–∞)

```sql
-- –ü—Ä–∏–º–µ—Ä —Å NOWAIT
BEGIN;
SELECT –ë–∞–ª–∞–Ω—Å FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101 FOR UPDATE NOWAIT;
-- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–ª—É—á–∏–º:
-- ERROR: could not obtain lock on row in relation "students"
```

### **3.4 –†–µ—à–µ–Ω–∏–µ 2: –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ SERIALIZABLE**

**–ò–¥–µ—è**: –î–æ–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–º–∏—Ç–∞, –Ω–µ –±—ã–ª–æ –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

**–°–µ—Å—Å–∏—è 1:**
```sql
-- ============================================
-- –†–ï–®–ï–ù–ò–ï: –£—Ä–æ–≤–µ–Ω—å SERIALIZABLE
-- ============================================

-- –°–±—Ä–æ—Å
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = 10000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;
COMMIT;

-- –ù–∞—á–∏–Ω–∞–µ–º —Å —É—Ä–æ–≤–Ω–µ–º SERIALIZABLE
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SELECT '–°–µ—Å—Å–∏—è 1 (SERIALIZABLE): –ù–∞—á–∞–ª–æ' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ë–∞–ª–∞–Ω—Å 
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;

-- –î–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
SELECT delay(4);

-- –û–±–Ω–æ–≤–ª—è–µ–º
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 1000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;

-- –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
COMMIT;
SELECT '–°–µ—Å—Å–∏—è 1: –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
```

**–°–µ—Å—Å–∏—è 2 (–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ SELECT –≤ —Å–µ—Å—Å–∏–∏ 1):**
```sql
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SELECT '–°–µ—Å—Å–∏—è 2 (SERIALIZABLE): –ù–∞—á–∞–ª–æ' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ë–∞–ª–∞–Ω—Å 
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;

-- –ö–æ—Ä–æ—Ç–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
SELECT delay(2);

-- –û–±–Ω–æ–≤–ª—è–µ–º
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 500 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;

-- –ü–æ–ø—ã—Ç–∫–∞ –∫–æ–º–º–∏—Ç–∞ (–º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å —Å –æ—à–∏–±–∫–æ–π!)
COMMIT;

SELECT CASE 
    WHEN NOT FOUND THEN '–°–µ—Å—Å–∏—è 2: –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏! –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—á–µ–Ω–∞.'
    ELSE '–°–µ—Å—Å–∏—è 2: –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞'
END AS —Ä–µ–∑—É–ª—å—Ç–∞—Ç;
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç?** –û–¥–Ω–∞ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—É—á–∏—Ç –æ—à–∏–±–∫—É:
```
ERROR: could not serialize access due to concurrent update
```

**–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏:**
```sql
CREATE OR REPLACE FUNCTION update_balance_with_retry(
    student_id INTEGER, 
    amount DECIMAL, 
    max_retries INTEGER DEFAULT 3
) RETURNS VARCHAR AS $$
DECLARE
    retries INTEGER := 0;
    success BOOLEAN := FALSE;
BEGIN
    WHILE retries < max_retries AND NOT success LOOP
        BEGIN
            -- –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ SERIALIZABLE
            EXECUTE '
                BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
                UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + $1 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = $2;
                COMMIT;
            ' USING amount, student_id;
            
            success := TRUE;
            RETURN '–£—Å–ø–µ—à–Ω–æ –ø–æ—Å–ª–µ ' || retries || ' –ø–æ–ø—ã—Ç–æ–∫';
            
        EXCEPTION WHEN serialization_failure THEN
            retries := retries + 1;
            -- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è backoff-–∑–∞–¥–µ—Ä–∂–∫–∞
            PERFORM pg_sleep(0.1 * POWER(2, retries));
            RAISE NOTICE '–ü–æ–ø—ã—Ç–∫–∞ % –∏–∑ %, –ø–æ–≤—Ç–æ—Ä—è–µ–º...', retries, max_retries;
        END;
    END LOOP;
    
    IF NOT success THEN
        RETURN '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å–ª–µ ' || max_retries || ' –ø–æ–ø—ã—Ç–æ–∫';
    END IF;
    
    RETURN '–£—Å–ø–µ—Ö';
END;
$$ LANGUAGE plpgsql;

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
SELECT update_balance_with_retry(102, 1000, 3);
```

### **3.5 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 2: –ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ (Non-repeatable Read)**

#### **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
–í –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–µ–∂–¥—É –Ω–∏–º–∏ –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.

**–ê–Ω–∞–ª–æ–≥–∏—è**: –í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ —Ü–µ–Ω—É –∫—É—Ä—Å–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (1999‚ÇΩ), —Ä–µ—à–∞–µ—Ç–µ –∫—É–ø–∏—Ç—å, –Ω–æ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ —Ü–µ–Ω–∞ —É–∂–µ 2499‚ÇΩ.

#### **–°—Ü–µ–Ω–∞—Ä–∏–π –≤ SkillFlow**
–°—Ç—É–¥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–Ω—É –∫—É—Ä—Å–∞, –¥—É–º–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—â–µ —Ä–∞–∑ ‚Äî –∞ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å!

**–°–µ—Å—Å–∏—è 1 (—Å—Ç—É–¥–µ–Ω—Ç):**
```sql
-- ============================================
-- –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø: –ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ
-- –£—Ä–æ–≤–µ–Ω—å: READ COMMITTED (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
-- ============================================

BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Ü–µ–Ω—ã –∫—É—Ä—Å–∞ Python
SELECT '=== –°–¢–£–î–ï–ù–¢ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–Ω—É ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '1. –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∫—É—Ä—Å–∞ Python (–≤—Ä–µ–º—è: ' || NOW() || '):' AS –∑–∞–ø—Ä–æ—Å,
       –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ AS —Ü–µ–Ω–∞,
       '–î—É–º–∞–µ–º 5 —Å–µ–∫—É–Ω–¥...' AS –¥–µ–π—Å—Ç–≤–∏–µ
FROM Course_Prices 
WHERE ID_–ö—É—Ä—Å–∞ = 401 
  AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;

-- 2. –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–∑–¥—É–º—å–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
SELECT delay(5);

-- 3. –í–¢–û–†–û–ô –∑–∞–ø—Ä–æ—Å —Ç–æ–π –∂–µ —Ü–µ–Ω—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π!)
SELECT '2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–Ω—É –µ—â–µ —Ä–∞–∑ (–≤—Ä–µ–º—è: ' || NOW() || '):' AS –∑–∞–ø—Ä–æ—Å,
       –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ AS —Ü–µ–Ω–∞,
       CASE 
           WHEN –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ != 1999.99 THEN '–¶–µ–Ω–∞ –ò–ó–ú–ï–ù–ò–õ–ê–°–¨!'
           ELSE '–¶–µ–Ω–∞ —Ç–∞ –∂–µ'
       END AS —Ä–µ–∑—É–ª—å—Ç–∞—Ç
FROM Course_Prices 
WHERE ID_–ö—É—Ä—Å–∞ = 401 
  AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;

COMMIT;
```

**–°–µ—Å—Å–∏—è 2 (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ SELECT –≤ —Å–µ—Å—Å–∏–∏ 1):**
```sql
-- ============================================
-- –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† –º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É
-- ============================================

BEGIN;

SELECT '=== –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† –º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;

-- 1. "–ó–∞–∫—Ä—ã–≤–∞–µ–º" —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É
UPDATE Course_Prices 
SET –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã = NOW()
WHERE ID_–ö—É—Ä—Å–∞ = 401 
  AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;

-- 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ü–µ–Ω—É
INSERT INTO Course_Prices (ID_–ö—É—Ä—Å–∞, –î–∞—Ç–∞_–ù–∞—á–∞–ª–∞_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã, –¶–µ–Ω–∞_–ö—É—Ä—Å–∞)
VALUES (401, NOW(), 2499.99);

COMMIT;

SELECT '–¶–µ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ —Å 1999.99 –Ω–∞ 2499.99' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
```

#### **–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–µ—Å—Å–∏–∏ 1:**
```
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è                    | –∑–∞–ø—Ä–æ—Å                                                 | —Ü–µ–Ω–∞   | –¥–µ–π—Å—Ç–≤–∏–µ/—Ä–µ–∑—É–ª—å—Ç–∞—Ç
------------------------------|--------------------------------------------------------|--------|-------------------
=== –°–¢–£–î–ï–ù–¢ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–Ω—É ===| 1. –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∫—É—Ä—Å–∞ Python (–≤—Ä–µ–º—è: 2024-...):      | 1999.99| –î—É–º–∞–µ–º 5 —Å–µ–∫—É–Ω–¥...
                              | 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–Ω—É –µ—â–µ —Ä–∞–∑ (–≤—Ä–µ–º—è: 2024-...):          | 2499.99| –¶–µ–Ω–∞ –ò–ó–ú–ï–ù–ò–õ–ê–°–¨!
```

#### **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞?**
1. –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
3. –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ "—á–∏—Ç–∞—é—â–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–∏–¥–µ—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"

### **3.6 –†–µ—à–µ–Ω–∏–µ: –£—Ä–æ–≤–µ–Ω—å REPEATABLE READ**

```sql
-- ============================================
-- –†–ï–®–ï–ù–ò–ï: –£—Ä–æ–≤–µ–Ω—å REPEATABLE READ
-- ============================================

-- –°–µ—Å—Å–∏—è 1 (—Å—Ç—É–¥–µ–Ω—Ç)
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;

SELECT '=== REPEATABLE READ: –ü–µ—Ä–≤–æ–µ —á—Ç–µ–Ω–∏–µ ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ 
FROM Course_Prices 
WHERE ID_–ö—É—Ä—Å–∞ = 401 
  AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;

-- –ü–∞—É–∑–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥—Ä—É–≥–æ–π —Å–µ—Å—Å–∏–∏
SELECT delay(5);

SELECT '=== REPEATABLE READ: –í—Ç–æ—Ä–æ–µ —á—Ç–µ–Ω–∏–µ ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT –¶–µ–Ω–∞_–ö—É—Ä—Å–∞,
       '–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –≤ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏' AS –≥–∞—Ä–∞–Ω—Ç–∏—è
FROM Course_Prices 
WHERE ID_–ö—É—Ä—Å–∞ = 401 
  AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;

COMMIT;
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
1. –ü—Ä–∏ `BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ` PostgreSQL —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç "—Å–Ω–∏–º–æ–∫" –¥–∞–Ω–Ω—ã—Ö
2. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ SELECT –≤ —ç—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç —ç—Ç–æ–≥–æ —Å–Ω–∏–º–∫–∞
3. –î–∞–∂–µ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–∞—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏—Ö –Ω–µ –≤–∏–¥–∏—Ç

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –ï—Å–ª–∏ –Ω–∞—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é —É–∂–µ –∏–∑–º–µ–Ω–∏–ª–∞ –¥—Ä—É–≥–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –º—ã –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É:
```
ERROR: could not serialize access due to concurrent update
```

### **3.7 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 3: –§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (Phantom Read)**

#### **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?**
–ü–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ (—Ñ–∞–Ω—Ç–æ–º—ã) –º–µ–∂–¥—É –¥–≤—É–º—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

**–ê–Ω–∞–ª–æ–≥–∏—è**: –í—ã —Å—á–∏—Ç–∞–µ—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –ø–æ Python (3 –∫—É—Ä—Å–∞), —Ä–µ—à–∞–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω, –Ω–æ –ø–æ–∫–∞ –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –∫—É—Ä—Å.

#### **–°—Ü–µ–Ω–∞—Ä–∏–π –≤ SkillFlow**
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å—á–∏—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —É—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è –æ—Ç—á–µ—Ç–∞, –∞ –ø–æ–∫–∞ –æ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç, —Å—Ç—É–¥–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –ø–ª–∞–Ω—ã.

**–°–µ—Å—Å–∏—è 1 (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä):**
```sql
-- ============================================
-- –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø: –§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
-- –£—Ä–æ–≤–µ–Ω—å: READ COMMITTED
-- ============================================

BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- 1. –ü–µ—Ä–≤—ã–π –ø–æ–¥—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
SELECT '=== –û—Ç—á–µ—Ç –Ω–∞—á–∞—Ç ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ (–≤—Ä–µ–º—è: ' || NOW() || '):' AS –∑–∞–ø—Ä–æ—Å,
       COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ,
       '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç 5 —Å–µ–∫—É–Ω–¥...' AS –¥–µ–π—Å—Ç–≤–∏–µ
FROM StudyPlans 
WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';

-- 2. –ò–º–∏—Ç–∏—Ä—É–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á–µ—Ç–∞
SELECT delay(5);

-- 3. –í—Ç–æ—Ä–æ–π –ø–æ–¥—Å—á–µ—Ç (–º–æ–≥—É—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –ø–ª–∞–Ω—ã!)
SELECT '2. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤—Ä–µ–º—è: ' || NOW() || '):' AS –∑–∞–ø—Ä–æ—Å,
       COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ,
       CASE 
           WHEN COUNT(*) > (SELECT COUNT(*) FROM StudyPlans WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω' OFFSET 0) 
           THEN '–ü–æ—è–≤–∏–ª–∏—Å—å –ù–û–í–´–ï –ø–ª–∞–Ω—ã!'
           ELSE '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å'
       END AS —Ä–µ–∑—É–ª—å—Ç–∞—Ç
FROM StudyPlans 
WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';

COMMIT;
```

**–°–µ—Å—Å–∏—è 2 (—Å—Ç—É–¥–µ–Ω—Ç—ã, –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ SELECT):**
```sql
-- ============================================
-- –°–¢–£–î–ï–ù–¢–´ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –ø–ª–∞–Ω—ã
-- ============================================

-- –°—Ç—É–¥–µ–Ω—Ç 1
BEGIN;
INSERT INTO StudyPlans (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
VALUES (NOW(), NOW() + INTERVAL '3 months', '–∞–∫—Ç–∏–≤–µ–Ω', 101, 402);
COMMIT;

-- –°—Ç—É–¥–µ–Ω—Ç 2 (—á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã)
SELECT delay(2);
BEGIN;
INSERT INTO StudyPlans (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
VALUES (NOW(), NOW() + INTERVAL '3 months', '–∞–∫—Ç–∏–≤–µ–Ω', 102, 403);
COMMIT;

SELECT '–°–æ–∑–¥–∞–Ω–æ 2 –Ω–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞–Ω–∞' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
```

### **3.8 –†–µ—à–µ–Ω–∏–µ: –£—Ä–æ–≤–µ–Ω—å SERIALIZABLE**

```sql
-- ============================================
-- –†–ï–®–ï–ù–ò–ï: –£—Ä–æ–≤–µ–Ω—å SERIALIZABLE
-- ============================================

BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SELECT '=== SERIALIZABLE: –ù–∞—á–∞–ª–æ –æ—Ç—á–µ—Ç–∞ ===' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è;
SELECT '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:' AS –∑–∞–ø—Ä–æ—Å,
       COUNT(*) AS —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
FROM StudyPlans 
WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';

-- –î–∞–∂–µ –µ—Å–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Å—Å–∏—è—Ö —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–ª–∞–Ω—ã...
SELECT delay(5);

-- ...–º—ã —É–≤–∏–¥–∏–º —Ç–æ –∂–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
SELECT '–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å):' AS –∑–∞–ø—Ä–æ—Å,
       COUNT(*) AS —Ç–µ–∫—É—â–µ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ,
       CASE 
           WHEN COUNT(*) = 5 THEN '‚úì –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å'
           ELSE '‚úó –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏!'
       END AS –ø—Ä–æ–≤–µ—Ä–∫–∞
FROM StudyPlans 
WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';

COMMIT;
```

**–í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –æ REPEATABLE READ –≤ PostgreSQL**: –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ SQL, –≤ PostgreSQL —É—Ä–æ–≤–µ–Ω—å REPEATABLE READ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç **–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ** —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ —á—Ç–µ–Ω–∏—è (—Ç–µ, —á—Ç–æ —Å–≤—è–∑–∞–Ω—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —É–∂–µ –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫), –Ω–æ –Ω–µ –≤—Å–µ. –î–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã –Ω—É–∂–µ–Ω SERIALIZABLE.

---

## **–ì–ª–∞–≤–∞ 4: –¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (SAVEPOINT)**

### **4.1 –ß—Ç–æ —Ç–∞–∫–æ–µ SAVEPOINT?**

**–¢–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** ‚Äî —ç—Ç–æ "–≤–ª–æ–∂–µ–Ω–Ω–∞—è" –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—è –≤—Å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

```
–ù–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (BEGIN)
    |
    |-- –û–ø–µ—Ä–∞—Ü–∏—è 1
    |-- SAVEPOINT point1
    |   |
    |   |-- –û–ø–µ—Ä–∞—Ü–∏—è 2 (–º–æ–∂–µ—Ç fail)
    |   |-- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: ROLLBACK TO point1
    |
    |-- –û–ø–µ—Ä–∞—Ü–∏—è 3
    |
–ö–æ–Ω–µ—Ü —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (COMMIT)
```

### **4.2 –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ü–æ–∫—É–ø–∫–∞ –∫—É—Ä—Å–∞ –≤ SkillFlow**

```sql
-- ============================================
-- –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ü–†–ò–ú–ï–†: –ü–æ–∫—É–ø–∫–∞ –∫—É—Ä—Å–∞ —Å SAVEPOINT
-- ============================================

-- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: —Å–±—Ä–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = 5000 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;
DELETE FROM StudyPlans WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 AND ID_–ö—É—Ä—Å–∞ = 402;
COMMIT;

-- –ù–∞—á–∏–Ω–∞–µ–º —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
BEGIN;

SELECT '=== –ù–ê–ß–ê–õ–û –¢–†–ê–ù–ó–ê–ö–¶–ò–ò –ü–û–ö–£–ü–ö–ò ===' AS —ç—Ç–∞–ø;
SELECT '–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ 103:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, 
       –ë–∞–ª–∞–Ω—Å AS –±–∞–ª–∞–Ω—Å_–¥–æ
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;

-- ============================================
-- –≠–¢–ê–ü 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ
-- ============================================
SELECT '--- –≠–¢–ê–ü 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ---' AS —ç—Ç–∞–ø;

-- –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –∫—É—Ä—Å–∞
WITH current_price AS (
    SELECT –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ 
    FROM Course_Prices 
    WHERE ID_–ö—É—Ä—Å–∞ = 402 
      AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL
)
SELECT '–¶–µ–Ω–∞ –∫—É—Ä—Å–∞ JavaScript:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, 
       –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ AS —Ü–µ–Ω–∞
FROM current_price;

-- –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ü–ï–†–ï–î —Å–ø–∏—Å–∞–Ω–∏–µ–º
SAVEPOINT before_payment;

-- –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
UPDATE Students 
SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å - 2499.99 
WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ø–∏—Å–∞–Ω–∏—è
SELECT '–ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, 
       –ë–∞–ª–∞–Ω—Å AS –±–∞–ª–∞–Ω—Å_–ø–æ—Å–ª–µ
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;

-- ============================================
-- –≠–¢–ê–ü 2: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–∏—Å–∞–Ω–∏—è
-- ============================================
SELECT '--- –≠–¢–ê–ü 2: –í–∞–ª–∏–¥–∞—Ü–∏—è ---' AS —ç—Ç–∞–ø;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—à–µ–ª –ª–∏ –±–∞–ª–∞–Ω—Å –≤ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π
DO $$
DECLARE 
    balance_after_payment DECIMAL;
BEGIN
    SELECT –ë–∞–ª–∞–Ω—Å INTO balance_after_payment 
    FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;
    
    IF balance_after_payment < 0 THEN
        RAISE NOTICE '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Å–ø–∏—Å–∞–Ω–∏–µ...';
        ROLLBACK TO SAVEPOINT before_payment;
        RAISE EXCEPTION '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ';
    ELSE
        RAISE NOTICE '–°—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ. –ë–∞–ª–∞–Ω—Å: %', balance_after_payment;
    END IF;
END $$;

-- ============================================
-- –≠–¢–ê–ü 3: –°–æ–∑–¥–∞–Ω–∏–µ —É—á–µ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
-- ============================================
SELECT '--- –≠–¢–ê–ü 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ ---' AS —ç—Ç–∞–ø;

-- –ù–æ–≤–∞—è —Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
SAVEPOINT before_plan_creation;

-- –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω
INSERT INTO StudyPlans 
    (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
VALUES 
    (NOW(), NOW() + INTERVAL '3 months', '–∞–∫—Ç–∏–≤–µ–Ω', 103, 402)
RETURNING '–°–æ–∑–¥–∞–Ω —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω ID:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, ID_–ü–ª–∞–Ω–∞;

-- ============================================
-- –≠–¢–ê–ü 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
-- ============================================
SELECT '--- –≠–¢–ê–ü 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ---' AS —ç—Ç–∞–ø;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—Ä—É—à–∏–ª–∏ –ª–∏ –º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ "–æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –∫—É—Ä—Å"
DO $$
DECLARE
    active_plans_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO active_plans_count
    FROM StudyPlans 
    WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 
      AND ID_–ö—É—Ä—Å–∞ = 402 
      AND –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';
    
    IF active_plans_count > 1 THEN
        RAISE NOTICE '–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ % –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤! –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ...', active_plans_count;
        ROLLBACK TO SAVEPOINT before_plan_creation;
        
        -- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π
        UPDATE StudyPlans 
        SET –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∑–∞–≤–µ—Ä—à–µ–Ω' 
        WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 
          AND ID_–ö—É—Ä—Å–∞ = 402 
          AND –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤en'
          AND ID_–ü–ª–∞–Ω–∞ != (SELECT MAX(ID_–ü–ª–∞–Ω–∞) FROM StudyPlans WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 AND ID_–ö—É—Ä—Å–∞ = 402);
        
        RAISE NOTICE '–°—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π';
    ELSE
        RAISE NOTICE '–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ —Å–æ–±–ª—é–¥–µ–Ω–æ: 1 –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω';
    END IF;
END $$;

-- ============================================
-- –≠–¢–ê–ü 5: –§–∏–∫—Å–∞—Ü–∏—è –∏–ª–∏ –æ—Ç–∫–∞—Ç
-- ============================================
SELECT '--- –§–ò–ù–ê–õ–¨–ù–´–ô –≠–¢–ê–ü ---' AS —ç—Ç–∞–ø;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π —É—Å–ø–µ—Ö
DO $$
DECLARE
    final_balance DECIMAL;
    plans_count INTEGER;
BEGIN
    SELECT –ë–∞–ª–∞–Ω—Å INTO final_balance FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;
    SELECT COUNT(*) INTO plans_count FROM StudyPlans WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 AND ID_–ö—É—Ä—Å–∞ = 402 AND –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';
    
    IF final_balance < 0 OR plans_count != 1 THEN
        RAISE EXCEPTION '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞! –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –≤—Å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
    ELSE
        RAISE NOTICE '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ë–∞–ª–∞–Ω—Å: %, –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤: %', final_balance, plans_count;
    END IF;
END $$;

-- –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, –∫–æ–º–º–∏—Ç–∏–º
COMMIT;

SELECT '=== –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê ===' AS —Ä–µ–∑—É–ª—å—Ç–∞—Ç;
SELECT '–ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ 103:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ë–∞–ª–∞–Ω—Å 
FROM Students WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103;
SELECT '–ê–∫—Ç–∏–≤–Ω—ã–µ —É—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã —Å—Ç—É–¥–µ–Ω—Ç–∞ 103:' AS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è,
       COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
FROM StudyPlans 
WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 103 AND –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';
```

### **4.3 –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å SAVEPOINT**

#### **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**
```sql
BEGIN;
    -- –û–ø–µ—Ä–∞—Ü–∏—è 1
    SAVEPOINT sp1;
    
    -- –û–ø–µ—Ä–∞—Ü–∏—è 2
    SAVEPOINT sp2;
    
    -- –û–ø–µ—Ä–∞—Ü–∏—è 3 (–æ—à–∏–±–∫–∞)
    RAISE EXCEPTION '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞';
    
    -- –ù–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
    SAVEPOINT sp3;
    
EXCEPTION WHEN OTHERS THEN
    -- –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –∫ sp2
    ROLLBACK TO sp2;
    RAISE NOTICE '–û—Ç–∫–∞—Ç–∏–ª–∏—Å—å –∫ sp2, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...';
    
    -- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
    -- –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º sp1 (–±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–µ–º—É)
    RELEASE SAVEPOINT sp1;
    
COMMIT;
```

#### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**
```sql
CREATE OR REPLACE FUNCTION safe_course_purchase(
    student_id INTEGER,
    course_id INTEGER
) RETURNS VARCHAR AS $$
DECLARE
    course_price DECIMAL;
    current_balance DECIMAL;
    plan_id INTEGER;
BEGIN
    -- –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    BEGIN
        -- –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—É
        SELECT –¶–µ–Ω–∞_–ö—É—Ä—Å–∞ INTO course_price
        FROM Course_Prices 
        WHERE ID_–ö—É—Ä—Å–∞ = course_id 
          AND –î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è_–î–µ–π—Å—Ç–≤–∏—è_–¶–µ–Ω—ã IS NULL;
        
        -- –¢–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è 1: –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
        SAVEPOINT before_payment;
        
        -- –°–ø–∏—Å–∞–Ω–∏–µ
        UPDATE Students 
        SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å - course_price 
        WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = student_id
        RETURNING –ë–∞–ª–∞–Ω—Å INTO current_balance;
        
        -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
        IF current_balance < 0 THEN
            ROLLBACK TO before_payment;
            RETURN '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
        END IF;
        
        -- –¢–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è 2: –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–ª–∞–Ω–∞
        SAVEPOINT before_plan;
        
        -- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞
        INSERT INTO StudyPlans 
            (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
        VALUES 
            (NOW(), NOW() + INTERVAL '3 months', '–∞–∫—Ç–∏–≤–µ–Ω', student_id, course_id)
        RETURNING ID_–ü–ª–∞–Ω–∞ INTO plan_id;
        
        -- –£—Å–ø–µ—Ö
        COMMIT;
        RETURN '–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω, ID: ' || plan_id;
        
    EXCEPTION 
        WHEN unique_violation THEN
            -- –ù–∞—Ä—É—à–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
            ROLLBACK TO before_plan;
            
            -- –ü–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π
            UPDATE StudyPlans 
            SET –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∑–∞–≤–µ—Ä—à–µ–Ω' 
            WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = student_id 
              AND ID_–ö—É—Ä—Å–∞ = course_id 
              AND –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';
            
            -- –ü—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
            INSERT INTO StudyPlans 
                (–î–∞—Ç–∞_–ù–∞—á–∞–ª–∞, –ü–ª–∞–Ω–æ–≤–∞—è_–î–∞—Ç–∞_–û–∫–æ–Ω—á–∞–Ω–∏—è, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞, ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞)
            VALUES 
                (NOW(), NOW() + INTERVAL '3 months', '–∞–∫—Ç–∏–≤–µ–Ω', student_id, course_id)
            RETURNING ID_–ü–ª–∞–Ω–∞ INTO plan_id;
            
            COMMIT;
            RETURN '–°—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω, —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π, ID: ' || plan_id;
            
        WHEN OTHERS THEN
            -- –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
            ROLLBACK;
            RETURN '–û—à–∏–±–∫–∞: ' || SQLERRM;
    END;
END;
$$ LANGUAGE plpgsql;

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
SELECT safe_course_purchase(103, 402);
```

---

## **–ì–ª–∞–≤–∞ 5: –ü–æ–ª–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é**

### **5.1 –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è DataGrip**

#### **–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (15 –º–∏–Ω—É—Ç)**
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL** –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–û—Ç–∫—Ä–æ–π—Ç–µ DataGrip**, —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `postgres`
3. **–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É skillflow**:
   ```sql
   CREATE DATABASE skillflow;
   ```
4. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ `skillflow`
5. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü** –∏–∑ –ì–ª–∞–≤—ã 2.2
6. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** –∏–∑ –ì–ª–∞–≤—ã 2.3

#### **–≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (5 –º–∏–Ω—É—Ç)**
1. **–°–æ–∑–¥–∞–π—Ç–µ 3 –∫–æ–Ω—Å–æ–ª–∏**:
   - –ö–æ–Ω—Å–æ–ª—å 1: –¥–ª—è "–°–µ—Å—Å–∏–∏ 1"
   - –ö–æ–Ω—Å–æ–ª—å 2: –¥–ª—è "–°–µ—Å—Å–∏–∏ 2" 
   - –ö–æ–Ω—Å–æ–ª—å 3: –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
2. **–†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ –æ–∫–Ω–∞**:
   ```
   +----------------+----------------+
   |   –°–µ—Å—Å–∏—è 1     |   –°–µ—Å—Å–∏—è 2     |
   |   (–ª–µ–≤–∞—è)      |   (–ø—Ä–∞–≤–∞—è)     |
   +----------------+----------------+
   |          –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥             |
   +---------------------------------+
   ```
3. **–û—Ç–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–∫–æ–º–º–∏—Ç** –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Å–æ–ª—è—Ö

#### **–≠—Ç–∞–ø 3: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º (45 –º–∏–Ω—É—Ç)**

##### **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 1: –ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (15 –º–∏–Ω—É—Ç)**
1. –í **–ö–æ–Ω—Å–æ–ª–∏ 1** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç "–ü–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" (–ì–ª–∞–≤–∞ 3.2)
2. **–ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É** –≤ **–ö–æ–Ω—Å–æ–ª–∏ 2** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
3. **–ù–∞–±–ª—é–¥–∞–π—Ç–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–±–µ–∏—Ö –∫–æ–Ω—Å–æ–ª—è—Ö
4. **–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ** —Å —Ä–µ—à–µ–Ω–∏–µ–º (SELECT FOR UPDATE)

##### **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 2: –ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ (15 –º–∏–Ω—É—Ç)**
1. –í **–ö–æ–Ω—Å–æ–ª–∏ 1** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–µ –¥–≤–∞ SELECT (–¥–æ delay)
2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –≤ **–ö–æ–Ω—Å–æ–ª–∏ 2** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ **–ö–æ–Ω—Å–æ–ª—å 1**, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ—Å—Ç–∞–≤—à—É—é—Å—è —á–∞—Å—Ç—å
4. **–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ** —Å REPEATABLE READ

##### **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è 3: –§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (15 –º–∏–Ω—É—Ç)**
1. –í **–ö–æ–Ω—Å–æ–ª–∏ 1** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ–¥—Å—á–µ—Ç –ø–ª–∞–Ω–æ–≤
2. –í **–ö–æ–Ω—Å–æ–ª–∏ 2** —Å–æ–∑–¥–∞–π—Ç–µ 2 –Ω–æ–≤—ã—Ö –ø–ª–∞–Ω–∞
3. –í **–ö–æ–Ω—Å–æ–ª–∏ 1** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –ø–æ–¥—Å—á–µ—Ç
4. **–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ** —Å SERIALIZABLE

#### **–≠—Ç–∞–ø 4: –¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (20 –º–∏–Ω—É—Ç)**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ **–ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø–æ–∫—É–ø–∫–∏ –∫—É—Ä—Å–∞** –≤ –æ–¥–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
2. **–ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å** —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞ 2000 –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ
3. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ**, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–∫–∞—Ç—ã –∫ —Ç–æ—á–∫–∞–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### **5.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞**

#### **–ö–æ–Ω—Å–æ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```sql
-- 1. –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
SELECT 
    pid AS "ID –ø—Ä–æ—Ü–µ—Å—Å–∞",
    usename AS "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
    application_name AS "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
    state AS "–°–æ—Å—Ç–æ—è–Ω–∏–µ",
    query_start AS "–ù–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞",
    now() - query_start AS "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
    LEFT(query, 100) AS "–ó–∞–ø—Ä–æ—Å (–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤)"
FROM pg_stat_activity 
WHERE state != 'idle' 
  AND query NOT LIKE '%pg_stat_activity%'
ORDER BY query_start;

-- 2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏
SELECT 
    blocked_locks.pid AS "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å",
    blocking_locks.pid AS "–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å",
    blocked_activity.query AS "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å",
    blocking_activity.query AS "–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å",
    now() - blocked_activity.query_start AS "–í—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏"
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity 
    ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks 
    ON blocking_locks.locktype = blocked_locks.locktype
    AND blocking_locks.pid != blocked_locks.pid
JOIN pg_catalog.pg_stat_activity blocking_activity 
    ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;

-- 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
SELECT 
    transactionid AS "ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏",
    virtualtransaction AS "–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è",
    pid AS "ID –ø—Ä–æ—Ü–µ—Å—Å–∞",
    mode AS "–†–µ–∂–∏–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏",
    granted AS "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞",
    fastpath AS "–ë—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å"
FROM pg_locks 
WHERE locktype = 'transactionid';

-- 4. –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–æ–ø–∞—Å–Ω—ã–µ!)
SELECT 
    pid,
    now() - xact_start AS duration,
    query,
    state
FROM pg_stat_activity 
WHERE state IN ('idle in transaction', 'active')
  AND now() - xact_start > interval '5 minutes'
ORDER BY duration DESC;
```

### **5.3 –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è**

#### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:**
- [ ] **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞** –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Excel
- [ ] **–í—Å–µ 3 –∞–Ω–æ–º–∞–ª–∏–∏ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã** –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ SkillFlow
- [ ] **–î–ª—è –∫–∞–∂–¥–æ–π –∞–Ω–æ–º–∞–ª–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–æ —Ä–µ—à–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏
- [ ] **–¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] **–°–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Å–æ–ª–µ–π DataGrip

#### **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏:**
1. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å** (40%) ‚Äî SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ
2. **–ü–æ–ª–Ω–æ—Ç–∞** (30%) ‚Äî –ø–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∏–∑ –∑–∞–¥–∞–Ω–∏—è
3. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å** (20%) ‚Äî –∫–æ–¥ —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, –µ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
4. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å** (10%) ‚Äî —Å–∫—Ä–∏–ø—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å "–∫–∞–∫ –µ—Å—Ç—å"

### **5.4 –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ**

#### **–û—à–∏–±–∫–∞ 1: "–æ—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: "WHERE")"**
**–ü—Ä–æ–±–ª–µ–º–∞**: 
```sql
CREATE TABLE StudyPlans (
    ...
    UNIQUE(ID_–°—Ç—É–¥–µ–Ω—Ç–∞, ID_–ö—É—Ä—Å–∞, –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞) WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω'
);
```
**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–π—Ç–µ —á–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –æ—Ç–¥–µ–ª—å–Ω–æ:
```sql
CREATE TABLE StudyPlans (...);
CREATE UNIQUE INDEX ... WHERE –°—Ç–∞—Ç—É—Å_–ü–ª–∞–Ω–∞ = '–∞–∫—Ç–∏–≤–µ–Ω';
```

#### **–û—à–∏–±–∫–∞ 2: "–Ω–∞—Ä—É—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞"**
**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å—Ç–∞–≤–ª—è–µ–º –∫—É—Ä—Å —Å `ID_–≠–∫—Å–ø–µ—Ä—Ç–∞ = 503`, –Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–∞ —Å —Ç–∞–∫–∏–º ID –Ω–µ—Ç.
**–†–µ—à–µ–Ω–∏–µ**: –°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å—Ç–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –ø–æ—Ç–æ–º –∫—É—Ä—Å—ã.

#### **–û—à–∏–±–∫–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è "–≤–∏—Å–∏—Ç"**
**–ü—Ä–æ–±–ª–µ–º–∞**: –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–¥–µ—Ç –¥—Ä—É–≥—É—é.
**–†–µ—à–µ–Ω–∏–µ**: –í –∫–æ–Ω—Å–æ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞–π–¥–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –∑–∞–≤–∏—Å—à–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:
```sql
SELECT pg_terminate_backend(pid) FROM pg_stat_activity 
WHERE state = 'idle in transaction' 
AND now() - state_change > interval '10 minutes';
```

### **5.5 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã**

#### **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –í–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Deadlock)**
```sql
-- –°–µ—Å—Å–∏—è 1
BEGIN;
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 100 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
SELECT delay(3);
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å - 100 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102; -- –ñ–¥–µ—Ç

-- –°–µ—Å—Å–∏—è 2 (–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ UPDATE –≤ —Å–µ—Å—Å–∏–∏ 1)
BEGIN;
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 200 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 102;
SELECT delay(1);
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å - 200 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101; -- –í–ó–ê–ò–ú–û–ë–õ–û–ö–ò–†–û–í–ö–ê!
```

PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç deadlock –∏ –ø—Ä–µ—Ä–≤–µ—Ç –æ–¥–Ω—É –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
```
ERROR: deadlock detected
DETAIL: Process 12345 waits for ShareLock on transaction 67890; blocked by process 13579.
Process 13579 waits for ShareLock on transaction 24680; blocked by process 12345.
```

#### **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```sql
-- –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ READ COMMITTED
BEGIN TRANSACTION ISOLATION LEVEL READ COMMITTED;
EXPLAIN ANALYZE
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 1 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
COMMIT;

-- –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ SERIALIZABLE  
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;
EXPLAIN ANALYZE
UPDATE Students SET –ë–∞–ª–∞–Ω—Å = –ë–∞–ª–∞–Ω—Å + 1 WHERE ID_–°—Ç—É–¥–µ–Ω—Ç–∞ = 101;
COMMIT;
```

---

## **–ì–ª–∞–≤–∞ 6: –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥—ã**

### **6.1 –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **PostgreSQL –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–ª—å–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é** ‚Äî –¥–∞–∂–µ READ COMMITTED –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥—Ä—è–∑–Ω—ã–µ —á—Ç–µ–Ω–∏—è
2. **–í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏ ‚Äî –∫–æ–º–ø—Ä–æ–º–∏—Å—Å** –º–µ–∂–¥—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
3. **MVCC –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å** —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
4. **–¢–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### **6.2 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è SkillFlow**

#### **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**
1. **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ READ COMMITTED** ‚Äî –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è 90% —Å–ª—É—á–∞–µ–≤
2. **–î–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** (–ø–æ–∫—É–ø–∫–∞ –∫—É—Ä—Å–æ–≤, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `SELECT FOR UPDATE` –∏–ª–∏ SERIALIZABLE
3. **–î–ª—è –æ—Ç—á–µ—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ REPEATABLE READ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–°–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –æ—Ñ–æ—Ä–º–ª—è–π—Ç–µ —Å —Ç–æ—á–∫–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

#### **–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:**
```sql
-- –®–∞–±–ª–æ–Ω 1: –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
BEGIN;
SELECT ... FOR UPDATE;  -- –Ø–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
-- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
COMMIT;

-- –®–∞–±–ª–æ–Ω 2: –ß—Ç–µ–Ω–∏–µ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
-- –°–ª–æ–∂–Ω—ã–µ SELECT-–∑–∞–ø—Ä–æ—Å—ã
COMMIT;

-- –®–∞–±–ª–æ–Ω 3: –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
BEGIN;
-- –®–∞–≥ 1
SAVEPOINT step1;
-- –®–∞–≥ 2 (–º–æ–∂–µ—Ç fail)
SAVEPOINT step2;
-- –ü—Ä–∏ –æ—à–∏–±–∫–µ: ROLLBACK TO SAVEPOINT step1;
COMMIT;
```

### **6.3 –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑—É—á–µ–Ω–∏–µ**

#### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:**
1. **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL** ‚Äî [Transaction Isolation](https://www.postgresql.org/docs/current/transaction-iso.html)
2. **–ö–Ω–∏–≥–∞ "PostgreSQL 14 Internals"** ‚Äî –≥–ª–∞–≤—ã –ø—Ä–æ MVCC –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
3. **–°—Ç–∞—Ç—å—è "A Critique of ANSI SQL Isolation Levels"** ‚Äî –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

#### **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è:**
1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ **–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É** —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–∫
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ **–ø–∞—Ç—Ç–µ—Ä–Ω "Compensating Transaction"** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü–æ–ª–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è**

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub](https://github.com/example/skillflow-transactions-demo).

### **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/example/skillflow-transactions-demo.git

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -d skillflow -f database_dump.sql

# 3. –û—Ç–∫—Ä–æ–π—Ç–µ DataGrip –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ skillflow

# 4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ demonstrations/
```

**–£–¥–∞—á–∏ –≤ –æ—Å–≤–æ–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π PostgreSQL!** –ü–æ–º–Ω–∏—Ç–µ: –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Äî —ç—Ç–æ –∑–∞–ª–æ–≥ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
